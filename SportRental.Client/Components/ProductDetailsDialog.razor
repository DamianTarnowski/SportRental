@using MudBlazor
@using SportRental.Shared.Models
@using System.ComponentModel.DataAnnotations

<MudDialog Class="product-dialog">
    <DialogContent>
        <MudStack Spacing="2">
            @{ var imageUrl = Product.GetImageUrl(600); }
            @if (!string.IsNullOrEmpty(imageUrl))
            {
                <img src="@imageUrl" alt="@Product.Name" class="product-dialog-image" />
            }
            else
            {
                <MudPaper Class="pa-4 pa-sm-6 text-center" Elevation="0" Style="border-radius: 12px; background: #f1f5f9;">
                    <MudIcon Icon="@Icons.Material.Filled.Image" Size="Size.Large" Color="Color.Default" />
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Zdjƒôcie wkr√≥tce dostƒôpne</MudText>
                </MudPaper>
            }

            <MudStack Spacing="1">
                <MudText Typo="Typo.h6" Class="fw-bold product-dialog-title">@Product.Name</MudText>
                @if (!string.IsNullOrEmpty(Product.Category))
                {
                    <MudText Typo="Typo.caption" Color="Color.Secondary">üè∑Ô∏è @Product.Category</MudText>
                }
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1" Class="flex-wrap">
                    <MudText Typo="Typo.subtitle1" Color="Color.Primary" Class="fw-bold">@Product.DailyPrice.ToString("C")/dzie≈Ñ</MudText>
                    @if (Product.HourlyPrice.HasValue && Product.HourlyPrice.Value > 0)
                    {
                        <MudText Typo="Typo.caption" Color="Color.Secondary">(@Product.HourlyPrice.Value.ToString("C")/godz.)</MudText>
                    }
                </MudStack>
                <MudStack Row="true" Spacing="1" Class="mt-1 flex-wrap">
                    @if (Product.IsAvailable && Product.AvailableQuantity > 0)
                    {
                        <MudChip T="string" Size="Size.Small" Color="Color.Success" Variant="Variant.Filled">‚úì Dostƒôpny</MudChip>
                    }
                    else
                    {
                        <MudChip T="string" Size="Size.Small" Color="Color.Error" Variant="Variant.Filled">‚úó Niedostƒôpny</MudChip>
                    }
                    <MudChip T="string" Size="Size.Small" Color="Color.Info" Variant="Variant.Outlined">üì¶ @Product.AvailableQuantity szt.</MudChip>
                </MudStack>
            </MudStack>

            @if (!string.IsNullOrEmpty(Product.Description))
            {
                <MudText Typo="Typo.body2" Class="product-dialog-description">@Product.Description</MudText>
            }
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton Variant="Variant.Text" OnClick="Cancel" Size="Size.Small">Zamknij</MudButton>
        <MudButton Variant="Variant.Filled"
                   Color="Color.Primary"
                   Size="Size.Small"
                   Disabled="@(Product.AvailableQuantity <= 0 || !Product.IsAvailable)"
                   OnClick="AddToCartClicked"
                   StartIcon="@Icons.Material.Filled.AddShoppingCart">
            üõí Do koszyka
        </MudButton>
    </DialogActions>
</MudDialog>

<style>
    .product-dialog {
        max-width: 500px;
    }
    
    .product-dialog-image {
        width: 100%;
        max-height: 250px;
        object-fit: cover;
        border-radius: 12px;
    }
    
    .product-dialog-title {
        font-size: 1.1rem;
        line-height: 1.3;
    }
    
    .product-dialog-description {
        color: #64748b;
        line-height: 1.5;
        max-height: 100px;
        overflow-y: auto;
    }
    
    @@media (max-width: 600px) {
        .product-dialog-image {
            max-height: 180px;
        }
        
        .product-dialog-title {
            font-size: 1rem;
        }
        
        .product-dialog-description {
            max-height: 80px;
            font-size: 0.85rem;
        }
    }
</style>

@code {
    [CascadingParameter] public IDialogReference DialogReference { get; set; } = default!;
    [Parameter, EditorRequired] public ProductDto Product { get; set; } = default!;
    [Parameter] public EventCallback<ProductDto> AddToCart { get; set; }

    private void Cancel() => DialogReference.Close(DialogResult.Cancel());

    private async Task AddToCartClicked()
    {
        if (AddToCart.HasDelegate)
        {
            await AddToCart.InvokeAsync(Product);
        }

        if (DialogReference != null)
        {
            DialogReference.Close(DialogResult.Ok(true));
        }
    }
}


