@using MudBlazor
@using SportRental.Shared.Models
@using System.ComponentModel.DataAnnotations

<MudDialog MaxWidth="MaxWidth.Medium" FullWidth="true" DisableFocusTrap="true">
    <DialogContent>
        <MudStack Spacing="3">
            @{ var imageUrl = Product.FullImageUrl ?? Product.ImageUrl; }
            @if (!string.IsNullOrEmpty(imageUrl))
            {
                <img src="@imageUrl" alt="@Product.Name" style="width: 100%; border-radius: 12px; object-fit: cover;" />
            }
            else
            {
                <MudPaper Class="pa-6 text-center" Elevation="0" Style="border-radius: 12px; background: #f1f5f9;">
                    <MudIcon Icon="@Icons.Material.Filled.Image" Size="Size.Large" Color="Color.Default" />
                    <MudText Typo="Typo.body1" Color="Color.Secondary">Zdjęcie wkrótce dostępne</MudText>
                </MudPaper>
            }

            <MudStack Spacing="1">
                <MudText Typo="Typo.h5" Class="fw-bold">@Product.Name</MudText>
                @if (!string.IsNullOrEmpty(Product.Category))
                {
                    <MudText Typo="Typo.subtitle2" Color="Color.Secondary">@Product.Category</MudText>
                }
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                    <MudText Typo="Typo.h6" Color="Color.Primary">@Product.DailyPrice.ToString("C") / dzień</MudText>
                    @if (Product.IsAvailable && Product.AvailableQuantity > 0)
                    {
                        <MudChip T="string" Size="Size.Small" Color="Color.Success">Dostępny</MudChip>
                    }
                    else
                    {
                        <MudChip T="string" Size="Size.Small" Color="Color.Error">Niedostępny</MudChip>
                    }
                    <MudChip T="string" Size="Size.Small" Color="Color.Info" Variant="Variant.Outlined">@Product.AvailableQuantity szt.</MudChip>
                </MudStack>
            </MudStack>

            @if (!string.IsNullOrEmpty(Product.Description))
            {
                <MudText Typo="Typo.body1">@Product.Description</MudText>
            }
            else
            {
                <MudText Typo="Typo.body2" Color="Color.Secondary">Opis będzie dostępny wkrótce.</MudText>
            }
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton Variant="Variant.Text" OnClick="Cancel">Zamknij</MudButton>
        <MudButton Variant="Variant.Filled"
                   Color="Color.Primary"
                   Disabled="@(Product.AvailableQuantity <= 0 || !Product.IsAvailable)"
                   OnClick="AddToCartClicked"
                   StartIcon="@Icons.Material.Filled.AddShoppingCart">
            Dodaj do koszyka
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] public IDialogReference DialogReference { get; set; } = default!;
    [Parameter, EditorRequired] public ProductDto Product { get; set; } = default!;
    [Parameter] public EventCallback<ProductDto> AddToCart { get; set; }

    private void Cancel() => DialogReference.Close(DialogResult.Cancel());

    private async Task AddToCartClicked()
    {
        if (AddToCart.HasDelegate)
        {
            await AddToCart.InvokeAsync(Product);
        }

        if (DialogReference != null)
        {
            DialogReference.Close(DialogResult.Ok(true));
        }
    }
}


