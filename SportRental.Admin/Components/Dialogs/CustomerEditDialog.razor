@using SportRental.Infrastructure.Domain
@using SportRental.Shared.Components
@using SportRental.Shared.Services
@using MudBlazor

<MudDialog>
    <DialogContent>
        <MudStack Spacing="2">
            @* Nag≈Ç√≥wek - kompaktowy *@
            <div class="d-flex align-center justify-space-between flex-wrap gap-1">
                <div>
                    <MudText Typo="Typo.h6" Style="font-weight: 600;">
                        @(IsNew ? "üë§ Nowy klient" : "‚úèÔ∏è Edytuj klienta")
                    </MudText>
                    <MudText Typo="Typo.caption" Color="Color.Default" Class="d-none d-sm-block">
                        Wype≈Çnij podstawowe dane kontaktowe klienta.
                    </MudText>
                </div>
            </div>

            <MudForm @ref="form">
                <MudStack Spacing="2">
                    <MudTextField @bind-Value="Customer.FullName"
                                  Label="Imiƒô i nazwisko"
                                  Required="true"
                                  RequiredError="Wymagane"
                                  Adornment="Adornment.Start"
                                  AdornmentIcon="@Icons.Material.Filled.Person"
                                  Variant="Variant.Outlined"
                                  Dense="true" />
                    
                    <MudGrid Spacing="2">
                        <MudItem xs="12" sm="6">
                            <MudTextField @bind-Value="Customer.Email"
                                          Label="Email"
                                          InputType="InputType.Email"
                                          Adornment="Adornment.Start"
                                          AdornmentIcon="@Icons.Material.Filled.Email"
                                          Variant="Variant.Outlined"
                                          Dense="true" />
                        </MudItem>
                        <MudItem xs="12" sm="6">
                            <PhoneInput @bind-Value="Customer.PhoneNumber"
                                        Label="Telefon"
                                        Variant="Variant.Outlined" />
                        </MudItem>
                    </MudGrid>
                    
                    <MudGrid Spacing="2">
                        <MudItem xs="12" sm="6">
                            <MudTextField @bind-Value="Customer.DocumentNumber"
                                          Label="Nr dokumentu"
                                          Adornment="Adornment.Start"
                                          AdornmentIcon="@Icons.Material.Filled.Badge"
                                          Variant="Variant.Outlined"
                                          Dense="true" />
                        </MudItem>
                        <MudItem xs="12" sm="6">
                            <MudTextField @bind-Value="Customer.Address"
                                          Label="Adres"
                                          Variant="Variant.Outlined"
                                          Dense="true" />
                        </MudItem>
                    </MudGrid>
                    
                    <MudTextField @bind-Value="Customer.Notes"
                                  Label="Notatki"
                                  Lines="2"
                                  Variant="Variant.Outlined"
                                  Dense="true" />
                </MudStack>
            </MudForm>
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton Variant="Variant.Text"
                   Color="Color.Secondary"
                   OnClick="Cancel"
                   Size="Size.Small">
            Anuluj
        </MudButton>
        <MudButton Variant="Variant.Filled"
                   Color="Color.Primary"
                   StartIcon="@Icons.Material.Filled.CheckCircle"
                   OnClick="Submit"
                   Size="Size.Small">
            @(IsNew ? "Dodaj" : "Zapisz")
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] private IMudDialogInstance MudDialog { get; set; } = default!;

    [Parameter]
    public Customer Customer { get; set; } = new();

    [Parameter]
    public bool IsNew { get; set; }

    private MudForm? form;

    private async Task Submit()
    {
        if (form is not null)
        {
            await form.Validate();
            if (!form.IsValid)
                return;
        }

        MudDialog.Close(DialogResult.Ok(Customer));
    }

    private void Cancel()
    {
        MudDialog.Cancel();
    }
}
