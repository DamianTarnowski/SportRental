@using SportRental.Infrastructure.Domain
@using SportRental.Shared.Components
@using SportRental.Shared.Services
@using MudBlazor

<MudDialog>
    <DialogContent>
        <MudStack Spacing="3">
            <MudStack Row="true" Class="mud-align-center mud-justify-space-between">
                <MudStack Spacing="1">
                    <MudText Typo="Typo.h6" Style="font-weight:600;">
                        @(IsNew ? "Nowy klient" : "Edytuj klienta")
                    </MudText>
                    <MudText Typo="Typo.caption" Color="Color.Default">
                        Wypełnij podstawowe dane kontaktowe klienta.
                    </MudText>
                </MudStack>
                <MudChip T="string" Color="Color.Primary" Variant="Variant.Text" StartIcon="@Icons.Material.Filled.Badge">
                    @(IsNew ? "Dodawanie" : "Edycja")
                </MudChip>
            </MudStack>

            <MudForm @ref="form">
                <MudGrid Spacing="3">
                    <MudItem xs="12">
                        <MudTextField @bind-Value="Customer.FullName"
                                      Label="Imię i nazwisko"
                                      Required="true"
                                      RequiredError="Imię i nazwisko jest wymagane"
                                      Adornment="Adornment.Start"
                                      AdornmentIcon="@Icons.Material.Filled.Person"
                                      Variant="Variant.Outlined" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudTextField @bind-Value="Customer.Email"
                                      Label="Email"
                                      InputType="InputType.Email"
                                      Adornment="Adornment.Start"
                                      AdornmentIcon="@Icons.Material.Filled.Email"
                                      Variant="Variant.Outlined" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <PhoneInput @bind-Value="Customer.PhoneNumber"
                                    Label="Numer telefonu"
                                    Variant="Variant.Outlined" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudTextField @bind-Value="Customer.DocumentNumber"
                                      Label="Numer dokumentu"
                                      Adornment="Adornment.Start"
                                      AdornmentIcon="@Icons.Material.Filled.Badge"
                                      Variant="Variant.Outlined" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudTextField @bind-Value="Customer.Address"
                                      Label="Adres"
                                      Lines="2"
                                      Variant="Variant.Outlined" />
                    </MudItem>
                    <MudItem xs="12">
                        <MudTextField @bind-Value="Customer.Notes"
                                      Label="Notatki"
                                      Lines="3"
                                      Variant="Variant.Outlined" />
                    </MudItem>
                </MudGrid>
            </MudForm>
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton Variant="Variant.Text"
                   Color="Color.Secondary"
                   OnClick="Cancel">
            Anuluj
        </MudButton>
        <MudButton Variant="Variant.Filled"
                   Color="Color.Primary"
                   StartIcon="@Icons.Material.Filled.CheckCircle"
                   OnClick="Submit">
            @(IsNew ? "Dodaj klienta" : "Zapisz zmiany")
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] private IMudDialogInstance MudDialog { get; set; } = default!;

    [Parameter]
    public Customer Customer { get; set; } = new();

    [Parameter]
    public bool IsNew { get; set; }

    private MudForm? form;

    private async Task Submit()
    {
        if (form is not null)
        {
            await form.Validate();
            if (!form.IsValid)
                return;
        }

        MudDialog.Close(DialogResult.Ok(Customer));
    }

    private void Cancel()
    {
        MudDialog.Cancel();
    }
}
