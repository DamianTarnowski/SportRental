@page "/admin/company-settings"
@rendermode InteractiveServer
@attribute [Authorize(Roles = "Owner,SuperAdmin")]
@inject IDbContextFactory<ApplicationDbContext> DbFactory
@inject SportRental.Infrastructure.Tenancy.ITenantProvider TenantProvider
@inject ISnackbar Snackbar
@inject NavigationManager Navigation
@inject AuthenticationStateProvider AuthStateProvider
@inject UserManager<ApplicationUser> UserManager

@if (_isMobile)
{
    @* ==================== MOBILE UI ==================== *@
    <MudContainer MaxWidth="MaxWidth.Large" Class="mt-2 px-2">
        @* Nag贸wek mobilny *@
        <MudPaper Class="pa-3 mb-2" Elevation="2" Style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px;">
            <div class="d-flex align-center justify-space-between">
                <MudText Typo="Typo.h6" Style="font-weight: 700;">锔 Ustawienia firmy</MudText>
                <MudIconButton Icon="@Icons.Material.Filled.Save" 
                               Color="Color.Inherit" 
                               OnClick="Save"
                               Disabled="@isSaving" />
            </div>
        </MudPaper>
        
        @if (tenant == null)
        {
            <MudProgressLinear Indeterminate="true" />
        }
        else
        {
            <MudStack Spacing="2">
                @* Informacje podstawowe *@
                <MudExpansionPanels Elevation="2">
                    <MudExpansionPanel Text=" Dane firmy" IsInitiallyExpanded="true" Style="border-radius: 10px;">
                        <MudStack Spacing="2">
                            <MudTextField @bind-Value="tenant.Name" Label="Nazwa firmy" Required="true" Dense="true" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.Address" Label="Adres" Lines="2" Dense="true" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.PhoneNumber" Label="Telefon" Dense="true" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.Email" Label="Email" InputType="InputType.Email" Dense="true" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.NIP" Label="NIP" MaxLength="20" Dense="true" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.REGON" Label="REGON" MaxLength="14" Dense="true" Variant="Variant.Outlined" />
                        </MudStack>
                    </MudExpansionPanel>
                    
                    <MudExpansionPanel Text=" Personalizacja" Style="border-radius: 10px;">
                        <MudStack Spacing="2">
                            <MudTextField @bind-Value="tenant.PrimaryColorHex" Label="Kolor g贸wny" Dense="true" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="tenant.SecondaryColorHex" Label="Kolor dodatkowy" Dense="true" Variant="Variant.Outlined" />
                            <MudText Typo="Typo.caption">Logo firmy</MudText>
                            <InputFile OnChange="OnLogoSelected" accept="image/*" />
                            @if (!string.IsNullOrWhiteSpace(tenant.LogoUrl))
                            {
                                <img src="@tenant.LogoUrl" alt="Logo" style="max-height: 60px; max-width: 150px;" />
                            }
                        </MudStack>
                    </MudExpansionPanel>
                    
                    <MudExpansionPanel Text=" Szablony Email" Style="border-radius: 10px;">
                        <MudStack Spacing="2">
                            <MudTextField @bind-Value="companyInfo.EmailThanksText" Label="Email - podzikowanie" Lines="2" Dense="true" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.EmailReminderText" Label="Email - przypomnienie" Lines="2" Dense="true" Variant="Variant.Outlined" />
                        </MudStack>
                    </MudExpansionPanel>
                    
                    <MudExpansionPanel Text=" Lokalizacja" Style="border-radius: 10px;">
                        <MudStack Spacing="2">
                            <MudTextField @bind-Value="companyInfo.City" Label="Miasto" ReadOnly="true" Dense="true" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.Voivodeship" Label="Wojew贸dztwo" ReadOnly="true" Dense="true" Variant="Variant.Outlined" />
                            <LeafletMap MapId="company-location-map-mobile"
                                        Height="250px"
                                        Latitude="@(companyInfo.Lat ?? 52.0)"
                                        Longitude="@(companyInfo.Lon ?? 19.0)"
                                        Zoom="@(companyInfo.Lat.HasValue ? 15 : 6)"
                                        AllowMarkerDrag="true"
                                        OnLocationChanged="OnLocationChanged"
                                        OnLocationDetailsChanged="OnLocationDetailsChanged" />
                        </MudStack>
                    </MudExpansionPanel>
                    
                    <MudExpansionPanel Text=" Dodatkowe" Style="border-radius: 10px;">
                        <MudStack Spacing="2">
                            <MudTextField @bind-Value="companyInfo.LegalForm" Label="Forma prawna" Dense="true" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.OpeningHours" Label="Godziny otwarcia" Dense="true" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.Description" Label="Opis" Lines="2" Dense="true" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.ExtraInfo" Label="Dodatkowe info" Lines="2" Dense="true" Variant="Variant.Outlined" />
                        </MudStack>
                    </MudExpansionPanel>
                </MudExpansionPanels>
                
                @* Przyciski *@
                <MudStack Row="true" Spacing="2" Class="mud-justify-end">
                    <MudButton Href="/admin/owner" Variant="Variant.Outlined" Size="Size.Small">Anuluj</MudButton>
                    <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="Save" Disabled="@isSaving" Size="Size.Small">
                        @if (isSaving) { <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-1" /> }
                        Zapisz
                    </MudButton>
                </MudStack>
            </MudStack>
        }
    </MudContainer>
}
else
{
    @* ==================== DESKTOP UI ==================== *@
    <MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
        <MudPaper Class="pa-6 mb-4" Elevation="4" Style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 20px;">
            <MudStack Row="true" Class="mud-align-center" Spacing="3">
                <MudIcon Icon="@Icons.Material.Filled.Settings" Size="Size.Large" />
                <div>
                    <MudText Typo="Typo.h4" Style="font-weight: 700;">Ustawienia firmy</MudText>
                    <MudText Typo="Typo.subtitle1" Style="opacity: 0.9;">Skonfiguruj dane i wygld wypo偶yczalni</MudText>
                </div>
            </MudStack>
        </MudPaper>
        
        @if (tenant == null)
        {
            <MudProgressLinear Indeterminate="true" />
        }
        else
        {
            <MudGrid Spacing="3">
                <MudItem xs="12" md="6">
                    <MudPaper Class="pa-4" Elevation="3" Style="border-radius: 16px;">
                        <MudText Typo="Typo.h6" Class="mb-3"> Informacje podstawowe</MudText>
                        <MudAlert Severity="Severity.Info" Dense="true" Class="mb-3">
                            <MudText Typo="Typo.body2">
                                 Te dane bd automatycznie uwzgldniane w umowach PDF wysyanych do klient贸w!
                            </MudText>
                        </MudAlert>
                        <MudStack Spacing="3">
                            <MudTextField @bind-Value="tenant.Name" Label="Nazwa firmy" Required="true" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.Address" Label="Adres" Lines="2" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.PhoneNumber" Label="Telefon" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.Email" Label="Email" InputType="InputType.Email" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.NIP" Label="NIP" HelperText="10 cyfr" MaxLength="20" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.REGON" Label="REGON" HelperText="9 lub 14 cyfr" MaxLength="14" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.LegalForm" Label="Forma prawna" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.OpeningHours" Label="Godziny otwarcia" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.Description" Label="Opis" Lines="2" Variant="Variant.Outlined" />
                        </MudStack>
                    </MudPaper>
                </MudItem>
                
                <MudItem xs="12" md="6">
                    <MudPaper Class="pa-4" Elevation="3" Style="border-radius: 16px;">
                        <MudText Typo="Typo.h6" Class="mb-3"> Personalizacja</MudText>
                        <MudStack Spacing="3">
                            <MudTextField @bind-Value="tenant.PrimaryColorHex" Label="Kolor g贸wny (#RRGGBB)" Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="tenant.SecondaryColorHex" Label="Kolor dodatkowy (#RRGGBB)" Variant="Variant.Outlined" />
                            <MudText Typo="Typo.caption">Logo firmy (PNG/SVG)</MudText>
                            <InputFile OnChange="OnLogoSelected" accept="image/*" />
                            @if (!string.IsNullOrWhiteSpace(tenant.LogoUrl))
                            {
                                <div>
                                    <MudText Typo="Typo.caption">Obecne logo:</MudText>
                                    <img src="@tenant.LogoUrl" alt="Logo" style="max-height: 80px; max-width: 200px;" />
                                </div>
                            }
                        </MudStack>
                    </MudPaper>
                </MudItem>
                
                <MudItem xs="12" md="6">
                    <MudPaper Class="pa-4" Elevation="3" Style="border-radius: 16px;">
                        <MudText Typo="Typo.h6" Class="mb-3"> Szablony Email</MudText>
                        <MudStack Spacing="3">
                            <MudTextField @bind-Value="companyInfo.EmailThanksText" 
                                          Label="Email - podzikowanie" 
                                          Lines="3"
                                          Variant="Variant.Outlined"
                                          HelperText="Email po zakoczeniu wynajmu" />
                            <MudTextField @bind-Value="companyInfo.EmailReminderText" 
                                          Label="Email - przypomnienie 1" 
                                          Lines="3"
                                          Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.EmailReminderText2" 
                                          Label="Email - przypomnienie 2" 
                                          Lines="3"
                                          Variant="Variant.Outlined" />
                            <MudTextField @bind-Value="companyInfo.EmailReminderText3" 
                                          Label="Email - przypomnienie 3" 
                                          Lines="3"
                                          Variant="Variant.Outlined" />
                        </MudStack>
                    </MudPaper>
                </MudItem>
                
                <MudItem xs="12">
                    <MudPaper Class="pa-4" Elevation="3" Style="border-radius: 16px;">
                        <MudText Typo="Typo.h6" Class="mb-3"> Dodatkowe informacje</MudText>
                        <MudTextField @bind-Value="companyInfo.ExtraInfo" 
                                      Label="Dodatkowe informacje" 
                                      Lines="3"
                                      Variant="Variant.Outlined"
                                      HelperText="Informacje dodatkowe o firmie" />
                    </MudPaper>
                </MudItem>
                
                <MudItem xs="12">
                    <MudPaper Class="pa-4" Elevation="3" Style="border-radius: 16px;">
                        <MudText Typo="Typo.h6" Class="mb-3"> Lokalizacja wypo偶yczalni</MudText>
                        <MudAlert Severity="Severity.Info" Dense="true" Class="mb-3">
                            <MudText Typo="Typo.body2">
                                Kliknij na mapie lub wyszukaj adres, aby ustawi lokalizacj wypo偶yczalni. 
                                Ta lokalizacja bdzie widoczna dla klient贸w w aplikacji.
                            </MudText>
                        </MudAlert>
                        <MudStack Spacing="3">
                            <MudGrid Spacing="2">
                                <MudItem xs="12" md="6">
                                    <MudTextField @bind-Value="companyInfo.City" 
                                                  Label="Miasto" 
                                                  ReadOnly="true"
                                                  Variant="Variant.Outlined"
                                                  Adornment="Adornment.Start"
                                                  AdornmentIcon="@Icons.Material.Filled.LocationCity" />
                                </MudItem>
                                <MudItem xs="12" md="6">
                                    <MudTextField @bind-Value="companyInfo.Voivodeship" 
                                                  Label="Wojew贸dztwo" 
                                                  ReadOnly="true"
                                                  Variant="Variant.Outlined"
                                                  Adornment="Adornment.Start"
                                                  AdornmentIcon="@Icons.Material.Filled.Map" />
                                </MudItem>
                            </MudGrid>
                            <MudStack Row="true" Spacing="2" Class="mb-2">
                                <MudNumericField T="double?" @bind-Value="companyInfo.Lat" 
                                                 Label="Szeroko geograficzna" 
                                                 Format="F6"
                                                 ReadOnly="true"
                                                 Variant="Variant.Outlined" />
                                <MudNumericField T="double?" @bind-Value="companyInfo.Lon" 
                                                 Label="Dugo geograficzna" 
                                                 Format="F6"
                                                 ReadOnly="true"
                                                 Variant="Variant.Outlined" />
                                @if (companyInfo.Lat.HasValue && companyInfo.Lon.HasValue)
                                {
                                    <MudButton Variant="Variant.Outlined" 
                                               Color="Color.Secondary" 
                                               OnClick="ClearLocation"
                                               StartIcon="@Icons.Material.Filled.Clear">
                                        Wyczy
                                    </MudButton>
                                }
                            </MudStack>
                            <LeafletMap MapId="company-location-map"
                                        Height="400px"
                                        Latitude="@(companyInfo.Lat ?? 52.0)"
                                        Longitude="@(companyInfo.Lon ?? 19.0)"
                                        Zoom="@(companyInfo.Lat.HasValue ? 15 : 6)"
                                        AllowMarkerDrag="true"
                                        OnLocationChanged="OnLocationChanged"
                                        OnLocationDetailsChanged="OnLocationDetailsChanged" />
                        </MudStack>
                    </MudPaper>
                </MudItem>
                
                <MudItem xs="12">
                    <MudStack Row="true" Spacing="2" Class="mud-justify-end">
                        <MudButton Href="/admin/owner" Variant="Variant.Outlined">Anuluj</MudButton>
                        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="Save" Disabled="@isSaving">
                            @if (isSaving)
                            {
                                <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                                <MudText Class="ml-2">Zapisywanie...</MudText>
                            }
                            else
                            {
                                <MudText>Zapisz ustawienia</MudText>
                            }
                        </MudButton>
                    </MudStack>
                </MudItem>
            </MudGrid>
        }
    </MudContainer>
}

<MudBreakpointProvider OnBreakpointChanged="OnBreakpointChanged" />

@code {
    // ==================== BREAKPOINT ====================
    private bool _isMobile = false;
    
    private void OnBreakpointChanged(Breakpoint breakpoint)
    {
        _isMobile = breakpoint < Breakpoint.Md;
        StateHasChanged();
    }

    // ==================== DATA ====================
    private Tenant? tenant;
    private CompanyInfoDto companyInfo = new();
    private IBrowserFile? selectedLogoFile;
    private bool isSaving = false;
    
    private Guid _tenantId = Guid.Empty;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            _tenantId = TenantProvider.GetCurrentTenantId() ?? Guid.Empty;
            
            if (_tenantId == Guid.Empty)
            {
                var authState = await AuthStateProvider.GetAuthenticationStateAsync();
                var userPrincipal = authState.User;
                if (userPrincipal?.Identity?.IsAuthenticated == true)
                {
                    var user = await UserManager.GetUserAsync(userPrincipal);
                    if (user?.TenantId.HasValue == true && user.TenantId.Value != Guid.Empty)
                    {
                        _tenantId = user.TenantId.Value;
                    }
                }
            }
            
            await LoadData();
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Bd adowania ustawie: {ex.Message}", Severity.Error);
        }
    }

    private async Task LoadData()
    {
        await using var Db = await DbFactory.CreateDbContextAsync();
        Db.SetTenant(_tenantId);
        
        tenant = await Db.Tenants.FirstOrDefaultAsync(t => t.Id == _tenantId);
        if (tenant == null)
        {
            if (_tenantId != Guid.Empty)
            {
                tenant = new Tenant { Id = _tenantId, Name = "Nowa wypo偶yczalnia" };
                Db.Tenants.Add(tenant);
                await Db.SaveChangesAsync();
                Snackbar.Add("Utworzono now firm - uzupenij dane", Severity.Info);
            }
            else
            {
                Snackbar.Add("Nie znaleziono danych firmy - zaloguj si ponownie", Severity.Error);
                return;
            }
        }

        var existingCompanyInfo = await Db.CompanyInfos.FirstOrDefaultAsync(ci => ci.TenantId == _tenantId);
        if (existingCompanyInfo != null)
        {
            companyInfo = new CompanyInfoDto
            {
                Address = existingCompanyInfo.Address,
                PhoneNumber = existingCompanyInfo.PhoneNumber,
                Email = existingCompanyInfo.Email,
                NIP = existingCompanyInfo.NIP,
                REGON = existingCompanyInfo.REGON,
                LegalForm = existingCompanyInfo.LegalForm,
                OpeningHours = existingCompanyInfo.OpeningHours,
                Description = existingCompanyInfo.Description,
                ExtraInfo = existingCompanyInfo.ExtraInfo,
                Lat = existingCompanyInfo.Lat,
                Lon = existingCompanyInfo.Lon,
                City = existingCompanyInfo.City,
                Voivodeship = existingCompanyInfo.Voivodeship,
                SmsConfirmationEnabled = existingCompanyInfo.SmsConfirmationEnabled,
                SmsThanksEnabled = existingCompanyInfo.SmsThanksEnabled,
                SmsReminderEnabled = existingCompanyInfo.SmsReminderEnabled,
                SmsThanksText = existingCompanyInfo.SmsThanksText,
                SmsReminderText = existingCompanyInfo.SmsReminderText,
                SmsReminderText2 = existingCompanyInfo.SmsReminderText2,
                SmsReminderText3 = existingCompanyInfo.SmsReminderText3,
                EmailThanksText = existingCompanyInfo.EmailThanksText,
                EmailReminderText = existingCompanyInfo.EmailReminderText,
                EmailReminderText2 = existingCompanyInfo.EmailReminderText2,
                EmailReminderText3 = existingCompanyInfo.EmailReminderText3
            };
        }
    }

    private void OnLogoSelected(InputFileChangeEventArgs e)
    {
        selectedLogoFile = e.File;
    }

    private void OnLocationChanged((double Lat, double Lon) location)
    {
        companyInfo.Lat = Math.Round(location.Lat, 6);
        companyInfo.Lon = Math.Round(location.Lon, 6);
        StateHasChanged();
    }

    private void OnLocationDetailsChanged(LeafletMap.LocationDetails details)
    {
        companyInfo.Lat = Math.Round(details.Lat, 6);
        companyInfo.Lon = Math.Round(details.Lon, 6);
        companyInfo.City = details.City;
        companyInfo.Voivodeship = details.Voivodeship;
        if (!string.IsNullOrWhiteSpace(details.Address))
        {
            companyInfo.Address = details.Address;
        }
        StateHasChanged();
    }

    private void ClearLocation()
    {
        companyInfo.Lat = null;
        companyInfo.Lon = null;
        companyInfo.City = null;
        companyInfo.Voivodeship = null;
        StateHasChanged();
    }

    private async Task Save()
    {
        if (tenant == null) return;
        
        isSaving = true;
        try
        {
            await using var Db = await DbFactory.CreateDbContextAsync();
            Db.SetTenant(_tenantId);
            
            Db.Tenants.Update(tenant);
            
            if (selectedLogoFile != null)
            {
                using var content = new MultipartFormDataContent();
                content.Add(new StreamContent(selectedLogoFile.OpenReadStream(5 * 1024 * 1024)), "file", selectedLogoFile.Name);
                
                var client = new HttpClient { BaseAddress = new Uri(Navigation.ToAbsoluteUri("/").ToString()) };
                var res = await client.PostAsync($"api/tenants/{_tenantId}/logo", content);
                if (res.IsSuccessStatusCode)
                {
                    var json = await res.Content.ReadFromJsonAsync<LogoResponse>();
                    tenant.LogoUrl = json?.logoUrl;
                }
            }
            
            var existingCompanyInfo = await Db.CompanyInfos.FirstOrDefaultAsync(ci => ci.TenantId == _tenantId);
            if (existingCompanyInfo != null)
            {
                existingCompanyInfo.Address = companyInfo.Address;
                existingCompanyInfo.PhoneNumber = companyInfo.PhoneNumber;
                existingCompanyInfo.Email = companyInfo.Email;
                existingCompanyInfo.NIP = companyInfo.NIP;
                existingCompanyInfo.REGON = companyInfo.REGON;
                existingCompanyInfo.LegalForm = companyInfo.LegalForm;
                existingCompanyInfo.OpeningHours = companyInfo.OpeningHours;
                existingCompanyInfo.Description = companyInfo.Description;
                existingCompanyInfo.ExtraInfo = companyInfo.ExtraInfo;
                existingCompanyInfo.Lat = companyInfo.Lat;
                existingCompanyInfo.Lon = companyInfo.Lon;
                existingCompanyInfo.City = companyInfo.City;
                existingCompanyInfo.Voivodeship = companyInfo.Voivodeship;
                existingCompanyInfo.SmsConfirmationEnabled = companyInfo.SmsConfirmationEnabled;
                existingCompanyInfo.SmsThanksEnabled = companyInfo.SmsThanksEnabled;
                existingCompanyInfo.SmsReminderEnabled = companyInfo.SmsReminderEnabled;
                existingCompanyInfo.SmsThanksText = companyInfo.SmsThanksText;
                existingCompanyInfo.SmsReminderText = companyInfo.SmsReminderText;
                existingCompanyInfo.SmsReminderText2 = companyInfo.SmsReminderText2;
                existingCompanyInfo.SmsReminderText3 = companyInfo.SmsReminderText3;
                existingCompanyInfo.EmailThanksText = companyInfo.EmailThanksText;
                existingCompanyInfo.EmailReminderText = companyInfo.EmailReminderText;
                existingCompanyInfo.EmailReminderText2 = companyInfo.EmailReminderText2;
                existingCompanyInfo.EmailReminderText3 = companyInfo.EmailReminderText3;
                existingCompanyInfo.UpdatedAtUtc = DateTime.UtcNow;
                
                Db.CompanyInfos.Update(existingCompanyInfo);
            }
            else
            {
                var newCompanyInfo = new CompanyInfo
                {
                    Id = Guid.NewGuid(),
                    TenantId = _tenantId,
                    Address = companyInfo.Address,
                    PhoneNumber = companyInfo.PhoneNumber,
                    Email = companyInfo.Email,
                    NIP = companyInfo.NIP,
                    REGON = companyInfo.REGON,
                    LegalForm = companyInfo.LegalForm,
                    OpeningHours = companyInfo.OpeningHours,
                    Description = companyInfo.Description,
                    ExtraInfo = companyInfo.ExtraInfo,
                    Lat = companyInfo.Lat,
                    Lon = companyInfo.Lon,
                    City = companyInfo.City,
                    Voivodeship = companyInfo.Voivodeship,
                    SmsConfirmationEnabled = companyInfo.SmsConfirmationEnabled,
                    SmsThanksEnabled = companyInfo.SmsThanksEnabled,
                    SmsReminderEnabled = companyInfo.SmsReminderEnabled,
                    SmsThanksText = companyInfo.SmsThanksText,
                    SmsReminderText = companyInfo.SmsReminderText,
                    SmsReminderText2 = companyInfo.SmsReminderText2,
                    SmsReminderText3 = companyInfo.SmsReminderText3,
                    EmailThanksText = companyInfo.EmailThanksText,
                    EmailReminderText = companyInfo.EmailReminderText,
                    EmailReminderText2 = companyInfo.EmailReminderText2,
                    EmailReminderText3 = companyInfo.EmailReminderText3,
                    CreatedAtUtc = DateTime.UtcNow,
                    UpdatedAtUtc = DateTime.UtcNow
                };
                
                await Db.CompanyInfos.AddAsync(newCompanyInfo);
            }
            
            await Db.SaveChangesAsync();
            
            Snackbar.Add("Ustawienia zostay zapisane", Severity.Success);
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Bd podczas zapisywania: {ex.Message}", Severity.Error);
        }
        finally
        {
            isSaving = false;
        }
    }

    private class CompanyInfoDto
    {
        public string? Address { get; set; }
        public string? PhoneNumber { get; set; }
        public string? Email { get; set; }
        public string? NIP { get; set; }
        public string? REGON { get; set; }
        public string? LegalForm { get; set; }
        public string? OpeningHours { get; set; }
        public string? Description { get; set; }
        public string? ExtraInfo { get; set; }
        public double? Lat { get; set; }
        public double? Lon { get; set; }
        public string? City { get; set; }
        public string? Voivodeship { get; set; }
        public bool SmsConfirmationEnabled { get; set; }
        public bool SmsThanksEnabled { get; set; }
        public bool SmsReminderEnabled { get; set; }
        public string? SmsThanksText { get; set; }
        public string? SmsReminderText { get; set; }
        public string? SmsReminderText2 { get; set; }
        public string? SmsReminderText3 { get; set; }
        public string? EmailThanksText { get; set; }
        public string? EmailReminderText { get; set; }
        public string? EmailReminderText2 { get; set; }
        public string? EmailReminderText3 { get; set; }
    }

    private class LogoResponse 
    { 
        public string? logoUrl { get; set; } 
    }
}
