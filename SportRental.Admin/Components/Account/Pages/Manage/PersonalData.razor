@page "/Account/Manage/PersonalData"

@using MudBlazor

@inject IdentityUserAccessor UserAccessor

<PageTitle>Dane osobowe - SportRental</PageTitle>

<MudStack Spacing="3">
    <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
        <MudIcon Icon="@Icons.Material.Filled.PrivacyTip" Color="Color.Primary" />
        <MudText Typo="Typo.h5">Dane osobowe</MudText>
    </MudStack>

    <StatusMessage />

    <MudAlert Severity="Severity.Info" Icon="@Icons.Material.Filled.Info" Class="mb-3">
        Twoje konto zawiera dane osobowe, które nam przekazałeś. Na tej stronie możesz pobrać lub usunąć te dane.
    </MudAlert>

    <MudGrid Spacing="3">
        <MudItem xs="12" md="6">
            <MudPaper Class="pa-4" Elevation="1" Style="border-radius: 12px;">
                <MudStack Spacing="2">
                    <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                        <MudIcon Icon="@Icons.Material.Filled.Download" Color="Color.Primary" />
                        <MudText Typo="Typo.h6">Pobierz dane</MudText>
                    </MudStack>
                    <MudText Typo="Typo.body2">
                        Pobierz kopię wszystkich danych osobowych przechowywanych na Twoim koncie.
                    </MudText>
                    <form action="Account/Manage/DownloadPersonalData" method="post">
                        <AntiforgeryToken />
                        <MudButton ButtonType="ButtonType.Submit" 
                                   Variant="Variant.Filled" 
                                   Color="Color.Primary"
                                   StartIcon="@Icons.Material.Filled.CloudDownload"
                                   FullWidth="true">
                            Pobierz moje dane
                        </MudButton>
                    </form>
                </MudStack>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" md="6">
            <MudPaper Class="pa-4" Elevation="1" Style="border-radius: 12px; border: 2px solid var(--mud-palette-error);">
                <MudStack Spacing="2">
                    <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                        <MudIcon Icon="@Icons.Material.Filled.DeleteForever" Color="Color.Error" />
                        <MudText Typo="Typo.h6" Color="Color.Error">Usuń konto</MudText>
                    </MudStack>
                    <MudText Typo="Typo.body2">
                        <strong>Uwaga:</strong> Usunięcie danych spowoduje trwałe usunięcie konta i nie będzie możliwości jego odzyskania.
                    </MudText>
                    <MudButton Href="Account/Manage/DeletePersonalData" 
                               Variant="Variant.Filled" 
                               Color="Color.Error"
                               StartIcon="@Icons.Material.Filled.Warning"
                               FullWidth="true">
                        Usuń moje konto
                    </MudButton>
                </MudStack>
            </MudPaper>
        </MudItem>
    </MudGrid>
</MudStack>

@code {
    [CascadingParameter]
    private HttpContext HttpContext { get; set; } = default!;

    protected override async Task OnInitializedAsync()
    {
        _ = await UserAccessor.GetRequiredUserAsync(HttpContext);
    }
}
