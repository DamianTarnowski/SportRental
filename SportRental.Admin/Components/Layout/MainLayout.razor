@inherits LayoutComponentBase

@inject IDbContextFactory<ApplicationDbContext> DbFactory
@inject SportRental.Infrastructure.Tenancy.ITenantProvider TenantProvider
@inject SportRental.Admin.Services.UI.ThemeService Theme

<InteractiveThemeProvider />

<MudLayout>
    <InteractiveNavigation />

    <MudMainContent Class="pt-16 px-2 px-sm-4">
        @Body
    </MudMainContent>
</MudLayout>

@code {
    protected override void OnInitialized()
    {
        _ = LoadBranding();
    }

    private async Task LoadBranding()
    {
        var tenantId = TenantProvider.GetCurrentTenantId();
        if (tenantId is null) return;
        await using var Db = await DbFactory.CreateDbContextAsync();
        Db.SetTenant(tenantId);
        var t = await Db.Tenants.AsNoTracking().FirstOrDefaultAsync(x => x.Id == tenantId.Value);
        if (t != null)
        {
            Theme.SetColors(t.PrimaryColorHex, t.SecondaryColorHex);
        }
    }
}
